## Oneview and Splunk integration
This is HPE hardware monitoring solution using HPE oneview and splunk

This repo will help getting the hpe oneview alerts through message queue and convert them into syslog format and then those syslogs will be forwarded to Splunk through splunk heavy forwarder

This is python based solution which listens on message queue ( SCMB ) for hardware alerts that are generated by HPE oneview.
Today there is no syslog feature in OneView. This solution helps to create the syslog using alerts generated in OneView. Additionaly this script gives more control to user in formating the log messages.

### Getting Started

Prerequisites - 

```
OS: 
	Centos 7.3  ( tested on centos but should work on RHEL )
Packages: 
	python 3.6 ( not tested on Python 2.7.x )
	pip3 (to install the following modules (including HPE oneview python module)
		amqplib==1.0.2
		future==0.16.0
		requests==2.10.0
		setuptools==39.0.1
		six==1.11.0
		hponeview==4.7.0 (https://github.com/HewlettPackard/python-hpOneView)
		
```

download the source and install the dependent packages:
```
1. Clone the project folder to suitable location and navigate to it. 

2. Run the following command to install the required modules.

	$ pip3 install -r requirements.txt
	
```
### Setting up Splunk Heavy forwarder

Setting up splunk heavy forwarder is out of scope for this document. Please follow the splunk document for this.
Hope to add content in the future.

### Steps to run script

check following before running the script:
 
1. Splunk indexer configured to receive data on a specific port. 
2. Splunk forwarder configured with splunk indexer, port and the folder with log data to be forwarded. 

then, follow the steps below:-
1. Edit the input config file with required oneview details

2. Start the script by issuing below command
```
$ <Project_Home>python3.6 main.py -i input.json

Eg: $ /home/user1/oneview_splunk python3.6 main.py -i config.json

```

### How to test
Generate alerts from oneview and ensure that the alerts are captured by the script. 

Monitor the log folder using tail command. 
```
tail -f <LOG_FILE>

Eg: $ tail -f oneview_splunk_logs/oneview_alerts_splunk.log

```
